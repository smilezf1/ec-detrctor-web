webpackJsonp([14],{At9G:function(e,t){},rXJ6:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("//Fk"),i=a.n(r),s=a("lHA8"),o=a.n(s),l=a("c/Tr"),n=a.n(l),c=a("Xxa5"),d=a.n(c),m=a("exGp"),u=a.n(m),p=a("47tL"),y=a("NBFj"),h=a("z4xJ"),g={name:"detectorStrategy",components:{pagination:y.a},mixins:[h.a],inject:["reload"],data:function(){return{listItem:[],curPage:1,limit:10,loading:!1,addTaskDrawer:!1,detectorStrategyDetailDrawer:!1,detectorStrategyDetailList:null,detectorAndroidItemOptions:[],detectorIosItemOptions:[],ruleForm:{strategyName:"",userName:""},detectorStrategyForm:{strategyName:"",strategyIsDynamic:"",strategyIsShelling:"",strategyType:1},rules:{strategyName:{required:!0,message:"请输入检测策略名称",trigger:"blur"},strategyIsDynamic:{required:!0,message:"请选择是否动态检测",trigger:"blur"},strategyIsShelling:{required:!0,message:"请选择是否脱壳",trigger:"blur"}},detectorAndroidItemList:[],detectorIosItemList:[],defaultdetectorAndroidItemList:[],defaultdetectorIosItemList:[],detectorTypeList:[],detectorAndroidTypeDetailList:[],detectorIosTypeDetailList:[],detectorTypeDetailList:[],detectorStrategyDetailItem:null,isIndeterminate:!0,activeNames:[],terminalType:1,allChecked:!1,selectedOptions:[]}},beforeMount:function(){this.getData()},methods:{handleRadioChange:function(e){this.terminalType=e,this.getDetectorList(e)},getData:function(){var e=this;return u()(d.a.mark(function t(){var a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(a={}).queryInfo=e.ruleForm,a.queryInfo.terminalType=e.terminalType,e.getDataItem(e.addPageInfo(a));case 4:case"end":return t.stop()}},t,e)}))()},getDataItem:function(e){var t=this;p.a.detrctorTaskService.findStrategyPage(e).then(function(a){if("00"==a.code){var r=a.data.count,i=e.pn,s=e.limit,o=e.queryInfo;t.listItem=a.data.items,t.curPage=i,t.limit=s,t.onGotPageData({totalElements:r,size:s,number:i,queryInfo:o})}})},search:function(e){var t=this;this.loading=!0;var a={};a.queryInfo=e,this.addPageInfo(a),this.getDataItem(a),setTimeout(function(){t.loading=!1},500)},refresh:function(){this.reload()},getDefaultOption:function(e,t){var a=this;return 1==t?(e.forEach(function(e){a.detectorAndroidItemList.push(e.key),a.detectorAndroidItemList=n()(new o.a(a.detectorAndroidItemList))}),this.defaultdetectorAndroidItemList=this.detectorAndroidItemList,this.defaultdetectorAndroidItemList):(e.forEach(function(e){a.detectorIosItemList.push(e.key),a.detectorIosItemList=n()(new o.a(a.detectorIosItemList))}),this.defaultdetectorIosItemList=this.detectorIosItemList,this.defaultdetectorIosItemList)},getAllOptions:function(e,t){for(var a=this,r=0;r<e.length;r++)0!=e[r].children.length&&e[r].children.forEach(function(e){1==t?(a.detectorAndroidItemOptions.push(e.key),a.detectorAndroidItemOptions=n()(new o.a(a.detectorAndroidItemOptions))):(a.detectorIosItemOptions.push(e.key),a.detectorIosItemOptions=n()(new o.a(a.detectorIosItemOptions)))}),this.activeNames.push(r)},getAllList:function(e,t,a){var r=this;return e&&e.map(function(e,i){e.selectedOptions=[],e.children=[],e.isSubCheckedAll=!1,e.isSubIndeterminate=!1,t.some(function(t){t.code==e.code&&(e.children.push(t),e.children.forEach(function(e,t){e.key=i+"-"+e.id,e.checkedCount=!1}))}),"titleCode17"!=e.code&&"titleCode001"!=e.code||(e.isSubCheckedAll=!0,r.getDefaultOption(e.children,a)),"titleCode17"==e.code&&(e.selectedOptions=r.detectorAndroidItemList),"titleCode001"==e.code&&(e.selectedOptions=r.detectorIosItemList)}),e},getDetectorList:function(e){var t=this,a=p.a.detectorStrategyService.getDetectionItemList(e).then(function(e){if("00"==e.code)return e.data}),r=p.a.detectorStrategyService.getDetectionItemTypeList(e).then(function(e){if("00"==e.code)return e.data});i.a.all([a,r]).then(function(a){t.detectorTypeList=a[1],t.detectorTypeDetailList=a[0],t.getAllList(t.detectorTypeList,t.detectorTypeDetailList,e),t.getAllOptions(t.detectorTypeList,e)})},addTask:function(){this.addTaskDrawer=!0,this.getDetectorList(this.terminalType)},handleCheckAllChange:function(e){var t=this,a=this.terminalType;this.allChecked=e,this.isIndeterminate=!1,this.detectorTypeList.forEach(function(r){r.isSubCheckedAll=e,"titleCode17"!=r.code&&"titleCode001"!=r.code||(r.isSubCheckedAll=!0),r.selectedOptions=1==a?e?t.detectorAndroidItemOptions:t.defaultdetectorAndroidItemList:e?t.detectorIosItemOptions:t.defaultdetectorIosItemList})},subHandleCheckAllChange:function(e,t){var a=this.terminalType,r=this.getSelectedOptions(this.detectorTypeList[t].children,e,t);this.detectorTypeList[t].selectedOptions=1==a?e?r:this.defaultdetectorAndroidItemList:e?r:this.defaultdetectorIosItemList,this.isIndeterminate=!0},AndroidHandleCheckChange:function(e,t){this.getSelectedOptions(this.detectorTypeList[t].children,e,t);var a=this.detectorTypeList[t].selectedOptions.length,r=this.countArray(this.detectorAndroidItemOptions,t);this.detectorTypeList[t].isSubCheckedAll=a==r,this.detectorTypeList[t].isSubIndeterminate=a>0&&a<r},iosHandleCheckChange:function(e,t){this.getSelectedOptions(this.detectorTypeList[t].children,e,t);var a=this.detectorTypeList[t].selectedOptions.length,r=this.countArray(this.detectorIosItemOptions,t);this.detectorTypeList[t].isSubCheckedAll=a==r,this.detectorTypeList[t].isSubIndeterminate=a>0&&a<r},getSelectedOptions:function(e,t,a){var r=this;this.terminalType;return this.selectedOptions=[],e.forEach(function(e,a){t?r.selectedOptions.push(e.key):r.selectedOptions=r.selectedOptions.splice(0,e.key)}),this.selectedOptions},countArray:function(e,t){if(e){var a=0,r=new RegExp("^"+t+"-*");return e.forEach(function(e){r.test(e)&&a++}),a}},mergeArray:function(e){for(var t=[],a=0;a<e.length;a++)t=t.concat(e[a].selectedOptions);return t},removeWhipptree:function(e){var t=[];return e.forEach(function(e){e&&t.push(e.split("-")[1])}),t},saveTask:function(){var e=this,t=this,a=!0,r=this.detectorStrategyForm;t.$refs.detectorStrategyForm.validate(function(i,s){if(i||(s.strategyIsShelling&&t.$message.error("请选择是否脱壳!"),s.strategyIsDynamic&&t.$message.error("请选择是否动态检测!"),s.strategyName&&t.$message.error("请输入检测策略名称！"),a=!1),1==e.terminalType?(e.detectionItemList=e.removeWhipptree(e.mergeArray(e.detectorTypeList)).concat(e.removeWhipptree(e.defaultdetectorAndroidItemList)),e.detectionItemList=n()(new o.a(e.detectionItemList))):(e.detectionItemList=e.removeWhipptree(e.mergeArray(e.detectorTypeList)).concat(e.removeWhipptree(e.defaultdetectorIosItemList)),e.detectionItemList=n()(new o.a(e.detectionItemList))),a){var l={detectionItemList:e.detectionItemList,strategyIsDynamic:r.strategyIsDynamic,strategyIsShelling:r.strategyIsShelling,strategyName:r.strategyName,strategyType:r.strategyType};p.a.detectorStrategyService.saveOrUpdateStrategy(l).then(function(e){"00"==e.code&&(t.addTaskDrawer=!1,t.$notify({message:"新增检测策略成功",type:"success",duration:1e3}),t.reload())})}})},cancelTask:function(){this.addTaskDrawer=!1},detail:function(e,t){var a=this;this.detectorStrategyDetailDrawer=!0;var r=p.a.detectorStrategyService.getDetectionItemTypeList(t).then(function(e){if("00"==e.code)return e.data}),s=p.a.detectorAndroidService.getStrategyDetail(e).then(function(e){if("00"==e.code)return e.data});i.a.all([r,s]).then(function(e){a.detectorStrategyDetailItem=e[1],a.detectorStrategyDetailItem.children=a.getAllList(e[0],e[1].detectionItemList,a.terminalType),a.getAllOptions(a.detectorStrategyDetailItem.children,a.terminalType)})},cancelDetectorStrategyDetail:function(){this.detectorStrategyDetailDrawer=!1}},mounted:function(){}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detectorStrategy"},[e._m(0),e._v(" "),a("div",{staticClass:"searchForm"},[a("div",{staticClass:"searchBox"},[a("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm}},[a("el-input",{attrs:{size:"small",placeholder:"请输入策略名称"},model:{value:e.ruleForm.strategyName,callback:function(t){e.$set(e.ruleForm,"strategyName",t)},expression:"ruleForm.strategyName"}}),e._v(" "),a("el-input",{attrs:{size:"small",placeholder:"请输入创建者"},model:{value:e.ruleForm.userName,callback:function(t){e.$set(e.ruleForm,"userName",t)},expression:"ruleForm.userName"}})],1)],1),e._v(" "),a("div",{staticClass:"operateBox"},[a("el-button",{staticClass:"searchButton",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.search(e.ruleForm)}}},[e._v("查询")]),e._v(" "),a("el-button",{staticClass:"addTaskButton",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.addTask()}}},[e._v("新增检测策略")]),e._v(" "),a("el-drawer",{staticClass:"addTaskDrawer",attrs:{title:"新增检测策略",visible:e.addTaskDrawer,"with-header":!1,wrapperClosable:!1,"close-on-press-esape":!1,"destroy-on-close":!0,size:"40%"},on:{"update:visible":function(t){e.addTaskDrawer=t}}},[a("div",{staticClass:"el-drawer-header"},[a("h3",[e._v("新增检测策略")])]),e._v(" "),a("div",{staticClass:"el-drawer-content"},[a("el-form",{ref:"detectorStrategyForm",attrs:{model:e.detectorStrategyForm,rules:e.rules}},[a("el-form-item",{attrs:{prop:"strategyName"}},[a("label",{attrs:{slot:"label"},slot:"label"},[e._v("检测策略名称:")]),e._v(" "),a("el-input",{staticStyle:{width:"70%"},attrs:{size:"small"},model:{value:e.detectorStrategyForm.strategyName,callback:function(t){e.$set(e.detectorStrategyForm,"strategyName",t)},expression:"detectorStrategyForm.strategyName"}})],1),e._v(" "),1==e.terminalType?a("el-form-item",{attrs:{prop:"strategyIsDynamic"}},[a("label",{attrs:{slot:"label"},slot:"label"},[e._v("是否动态检测:")]),e._v(" "),a("el-select",{staticStyle:{width:"70%"},attrs:{placeholder:"是否动态检测",size:"small","popper-append-to-body":!1},model:{value:e.detectorStrategyForm.strategyIsDynamic,callback:function(t){e.$set(e.detectorStrategyForm,"strategyIsDynamic",t)},expression:"detectorStrategyForm.strategyIsDynamic"}},[a("el-option",{key:"1",attrs:{value:1,label:"是"}},[e._v("是")]),e._v(" "),a("el-option",{key:"0",attrs:{value:0,label:"否"}},[e._v("否")])],1)],1):e._e(),e._v(" "),1==e.terminalType?a("el-form-item",{attrs:{prop:"strategyIsShelling"}},[a("label",{attrs:{slot:"label"},slot:"label"},[e._v("是  否  脱  壳:")]),e._v(" "),a("el-select",{staticStyle:{width:"70%"},attrs:{placeholder:"是否脱壳",size:"small","popper-append-to-body":!1},model:{value:e.detectorStrategyForm.strategyIsShelling,callback:function(t){e.$set(e.detectorStrategyForm,"strategyIsShelling",t)},expression:"detectorStrategyForm.strategyIsShelling"}},[a("el-option",{key:"1",attrs:{value:1,label:"是"}},[e._v("是")]),e._v(" "),a("el-option",{key:"0",attrs:{value:0,label:"否"}},[e._v("否")])],1)],1):e._e(),e._v(" "),a("el-form-item",[a("label",{attrs:{slot:"label"},slot:"label"},[e._v("  适  用  系  统:")]),e._v(" "),a("el-radio-group",{on:{change:e.handleRadioChange},model:{value:e.detectorStrategyForm.strategyType,callback:function(t){e.$set(e.detectorStrategyForm,"strategyType",t)},expression:"detectorStrategyForm.strategyType"}},[a("el-radio",{attrs:{label:1}},[e._v("Android")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("iOS")])],1)],1),e._v(" "),a("el-form-item",[a("label",{attrs:{slot:"label"},slot:"label"},[e._v("  检  测  项  目:")]),e._v(" "),a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.selectedOptions,callback:function(t){e.selectedOptions=t},expression:"selectedOptions"}},[e._v("全选")])],1),e._v(" "),a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.detectorTypeList,function(t,r){return a("el-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.children.length,expression:"item.children.length"}],key:t.id,attrs:{name:r}},[a("label",{attrs:{slot:"title"},slot:"title"},[a("span",[e._v(" "+e._s(t.name))]),e._v(" "),a("el-checkbox",{staticStyle:{"margin-left":"20px"},attrs:{indeterminate:t.isSubIndeterminate,disabled:"titleCode17"==t.code||"titleCode001"==t.code},on:{change:function(t){return e.subHandleCheckAllChange(t,r)}},model:{value:t.isSubCheckedAll,callback:function(a){e.$set(t,"isSubCheckedAll",a)},expression:"item.isSubCheckedAll"}},[e._v("全选")])],1),e._v(" "),1==e.terminalType?[a("el-checkbox-group",{on:{change:function(t){return e.AndroidHandleCheckChange(t,r)}},model:{value:t.selectedOptions,callback:function(a){e.$set(t,"selectedOptions",a)},expression:"item.selectedOptions"}},e._l(t.children,function(t){return a("el-checkbox",{key:t.id,staticStyle:{width:"45%","margin-bottom":"15px"},attrs:{label:t.key,disabled:"titleCode17"==t.code||"titleCode001"==t.code}},[e._v(e._s(t.name))])}),1)]:e._e(),e._v(" "),2==e.terminalType?[a("el-checkbox-group",{on:{change:function(t){return e.iosHandleCheckChange(t,r)}},model:{value:t.selectedOptions,callback:function(a){e.$set(t,"selectedOptions",a)},expression:"item.selectedOptions"}},e._l(t.children,function(t){return a("el-checkbox",{key:t.id,staticStyle:{width:"45%","margin-bottom":"15px"},attrs:{label:t.key,disabled:"titleCode17"==t.code||"titleCode001"==t.code}},[e._v(e._s(t.name)+"\n                    ")])}),1)]:e._e()],2)}),1)],1)],1),e._v(" "),a("div",{staticClass:"el-drawer-footer"},[a("div",{staticClass:"buttonBox",staticStyle:{display:"inline-block"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveTask()}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{plain:""},on:{click:function(t){return e.cancelTask()}}},[e._v("取消")])],1)])]),e._v(" "),a("el-button",{staticClass:"refreshButton",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.refresh()}}},[e._v("刷新")])],1)]),e._v(" "),a("div",{staticClass:"detectorStrategyBody"},[[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"listItem",attrs:{data:e.listItem,"element-loading-text":"加载中"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((e.curPage-1)*e.limit+t.$index+1))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"strategy_name",label:"策略名称",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{prop:"strategy_type",label:"适用系统",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.strategy_type?a("span",[e._v("Android")]):e._e(),e._v(" "),"2"==t.row.strategy_type?a("span",[e._v("iOS")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"strategy_count",label:"检测项数量",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"strategy_is_dynamic",label:"是否动态检测",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.strategy_is_dynamic?a("span",[e._v("是")]):e._e(),e._v(" "),"0"==t.row.strategy_is_dynamic?a("span",[e._v("否")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"strategy_is_shelling",label:"是否脱壳",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.strategy_is_shelling?a("span",[e._v("是")]):e._e(),e._v(" "),"0"==t.row.strategy_is_shelling?a("span",[e._v("否")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"创建者",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{effect:"dark",content:"详情",placement:"top-start"}},[a("i",{staticClass:"el-icon-tickets detailIcon",on:{click:function(a){return e.detail(t.row.strategy_id,t.row.strategy_type)}}})]),e._v(" "),a("el-drawer",{attrs:{title:"检测策略详情",visible:e.detectorStrategyDetailDrawer,"with-header":!1,wrapperClosable:!1,"close-on-press-esape":!1,"destroy-on-close":!0,size:"40%"},on:{"update:visible":function(t){e.detectorStrategyDetailDrawer=t}}},[a("div",{staticClass:"el-drawer-header"},[a("h3",[e._v("检测策略详情")])]),e._v(" "),a("div",{staticClass:"el-drawer-content"},[e.detectorStrategyDetailItem?[a("el-form",{attrs:{model:e.detectorStrategyDetailItem}},[a("el-form-item",[e._v("检测策略名称:  "+e._s(e.detectorStrategyDetailItem.strategyName))]),e._v(" "),a("el-form-item",[e._v("适用系统:  \n                      "),a("el-radio-group",{model:{value:e.detectorStrategyDetailItem.strategyType,callback:function(t){e.$set(e.detectorStrategyDetailItem,"strategyType",t)},expression:"detectorStrategyDetailItem.strategyType"}},[a("el-radio",{attrs:{label:1,disabled:""}},[e._v("Android")]),e._v(" "),a("el-radio",{attrs:{label:2,disabled:""}},[e._v("iOS")])],1)],1),e._v(" "),a("el-form-item",[e._v("检测项目"+e._s(e.detectorStrategyDetailItem.detectionItemList.length)+"项")]),e._v(" "),a("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.detectorStrategyDetailItem.children,function(t,r){return a("el-collapse-item",{directives:[{name:"show",rawName:"v-show",value:t.children.length,expression:"item.children.length"}],key:t.id,attrs:{name:r}},[a("label",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.name))]),e._v(" "),e._l(t.children,function(t){return a("el-checkbox",{key:t.id,staticStyle:{width:"45%","margin-bottom":"15px"},attrs:{disabled:!0,checked:!0}},[e._v(e._s(t.name))])})],2)}),1)],1)]:e._e()],2),e._v(" "),a("div",{staticClass:"el-drawer-footer"},[a("div",{staticClass:"buttonBox",staticStyle:{display:"inline-block"}},[a("el-button",{attrs:{plain:""},on:{click:function(t){return e.cancelDetectorStrategyDetail()}}},[e._v("取消")])],1)])])]}}])})],1)]],2),e._v(" "),a("div",{staticClass:"detectorStrategyBase"},[a("pagination",{on:{pageChanged:e.onPageChanged}})],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"detectorStrategyHeader"},[t("p",[this._v("当前位置:检测策略配置")])])}]};var f=a("VU/8")(g,v,!1,function(e){a("At9G")},null,null);t.default=f.exports}});
//# sourceMappingURL=14.2a5b76881f8fa2b074d9.js.map