webpackJsonp([11],{"7FeM":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("lHA8"),r=a.n(o),n=a("c/Tr"),i=a.n(n),l=a("Xxa5"),s=a.n(l),c=a("exGp"),d=a.n(c),p=a("47tL"),u=a("NBFj"),m=a("z4xJ"),v={name:"android",components:{pagination:u.a},mixins:[m.a],inject:["reload"],data:function(){var e=this;return{reportParameter:"0",reportType:2,pickOptionsStart:{disabledDate:function(t){return t.getTime()>new Date(e.ruleForm.maxDetectionTime).getTime()||t.getTime()>Date.now()}},pickOptionsEnd:{disabledDate:function(t){return t.getTime()<new Date(e.ruleForm.minDetectionTime).getTime()||t.getTime()>Date.now()}},ruleForm:{appName:"",appVersion:"",detectionStatus:"",minDetectionTime:"",maxDetectionTime:""},rules:{detectorStrategyId:[{required:!0,message:"请选择检测策略",trigger:"blur"}]},detectionStatusOptions:[{value:"0",label:"等待检测"},{value:"4",label:"引擎检测完成"},{value:"3",label:"检测失败"},{value:"1",label:"检测中"},{value:"2",label:"已完成"}],uploadForm:[],fileList:[],uploadTaskFileItem:[],activeNames:[],detectorStrategyList:[],uploadShow:!0,downloadReportDrawer:!1,addTaskDrawer:!1,loading:!1,listItem:[],curpage:1,limit:10,taskId:null,uploadTaskNum:null,loadingNum:null}},beforeMount:function(){this.getData()},computed:{getLoadingNum:function(){return this.loadingNum=this.uploadTaskNum-this.uploadTaskFileItem.length},getParameter:function(){return function(e){return e<=2?{isCompliance:e}:{isCompliance:2,reportDesignId:e}}}},methods:{getData:function(){var e=this;return d()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(a={}).queryInfo=e.ruleForm,a.queryInfo.terminalType=1,e.getDataItem(e.addPageInfo(a));case 4:case"end":return t.stop()}},t,e)}))()},getDataItem:function(e){var t=this;return p.a.detectorAndroidService.androidList(e).then(function(a){if("00"==a.code){var o=a.data.count,r=e.pn,n=e.limit;t.listItem=a.data.items,t.curpage=r,t.limit=n,t.onGotPageData({totalElements:o,size:n,number:r})}}),e},handleExceed:function(e,t){this.$message.warning("最多只能上传20个文件哦")},handleProgress:function(e,t,a){this.uploadTaskNum=a.length},uploadTaskFile:function(e){var t=this,a=new FormData,o=this;a.append("file",e.file);var n={onUploadProgress:function(t){var a=t.loaded/t.total*100|0;e.onProgress({percent:a})}};p.a.detrctorTaskService.findStrategyList(1).then(function(e){"00"==e.code&&(t.detectorStrategyList=e.data)}),p.a.uploadService.uploadFile(a,n).then(function(e){if("01"!=e.code&&"99"!=e.code&&"500"!=e.code||(o.addTaskDrawer=!1,o.$refs.uploadTask.clearFiles()),"00"==e.code){t.uploadForm.push({detectorStrategyId:""}),o.uploadTaskFileItem.push(e.data),o.uploadShow=!1;for(var a=0;a<o.uploadTaskFileItem.length;a++)o.activeNames.push(a+1),o.activeNames=i()(new r.a(o.activeNames))}})},search:function(e){var t=this,a={};a.queryInfo=e,a.queryInfo.terminalType=1,this.loading=!0,this.addPageInfo(a),this.getDataItem(a),setTimeout(function(){t.loading=!1},500)},addTask:function(){this.addTaskDrawer=!0},saveTask:function(){var e=this,t=!0,a=this.uploadTaskFileItem.map(function(a,o){var r={detectionAppInfo:{appFileName:a.appFileName,appIcon:a.appIcon,appMbyte:a.appMbyte,appName:a.appName,appPackage:a.appPackage,appPath:a.appPath,appVersion:a.appVersion,detectionCount:a.detectionCount,md5:a.md5,terminalType:a.terminalType},detectionStrategyId:e.uploadForm[o].detectorStrategyId};return e.$refs.uploadForm[o].validate(function(e){e||(t=!1)}),r});t&&p.a.detectorAndroidService.saveAndStartDetection(a).then(function(t){"00"==t.code&&e.$notify({message:"开始检测",type:"success"}),e.addTaskDrawer=!1,e.reload()})},cancelTask:function(){var e=this;this.uploadTaskFileItem.length?new this.$messageTips(function(e){(0,e.confirm)({content:"会清空当前上传的文件,是否继续?"})}).then(function(){e.addTaskDrawer=!1,e.$refs.uploadTask.clearFiles(),e.reload()}):this.addTaskDrawer=!1},downloadApk:function(e){var t=localStorage.getItem("Authorization"),a=this.api.baseUrl+"/detector/android/downloadApk?id="+e+"&Authorization="+t;window.location.href=a},downloadReport:function(e){this.taskId=e,this.downloadReportDrawer=!0},saveDownloadReport:function(e){var t=this.getParameter(e),a=this.taskId,o=localStorage.getItem("Authorization"),r=t.isCompliance,n=t.reportDesignId,i=this.reportType,l=null;l=n?this.api.baseUrl+"/detector/android/downloadReport?id="+a+"&isCompliance="+r+"&reportDesignId="+n+"&reportType="+i+"&Authorization="+o:this.api.baseUrl+"/detector/android/downloadReport?id="+a+"&isCompliance="+r+"&reportType="+i+"&Authorization="+o,window.location.href=l,this.downloadReportDrawer=!1},cancelDownloadReport:function(){this.downloadReportDrawer=!1},refresh:function(){this.reload()},detailTask:function(e){this.$router.push({path:"/home/detector/android/detail",query:{id:e}})},deleteTask:function(e){var t=this;new this.$messageTips(function(e){(0,e.confirm)({content:"确定要删除应用及其所有检测记录?"})}).then(function(a){p.a.detectorAndroidService.deleteAndroidListById(e).then(function(e){"00"==e.code&&(t.$message({type:"success",message:"删除成功"}),t.reload())})})}},beforeRouteLeave:function(e,t,a){"androidDetail"==e.name?this.$store.commit("getCacheComponents",["android"]):this.$store.commit("getCacheComponents",[]),a()}},f={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"android"},[e._m(0),e._v(" "),o("div",{staticClass:"searchForm"},[o("div",{staticClass:"searchBox"},[o("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm}},[o("el-input",{attrs:{size:"small",placeholder:"请输入应用名称"},model:{value:e.ruleForm.appName,callback:function(t){e.$set(e.ruleForm,"appName",t)},expression:"ruleForm.appName"}}),e._v(" "),o("el-input",{attrs:{size:"small",placeholder:"请选择版本号"},model:{value:e.ruleForm.appVersion,callback:function(t){e.$set(e.ruleForm,"appVersion",t)},expression:"ruleForm.appVersion"}}),e._v(" "),o("el-select",{attrs:{placeholder:"请选择检测状态",size:"small"},model:{value:e.ruleForm.detectionStatus,callback:function(t){e.$set(e.ruleForm,"detectionStatus",t)},expression:"ruleForm.detectionStatus"}},e._l(e.detectionStatusOptions,function(e){return o("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}),1),e._v(" "),o("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"开始时间",size:"small","picker-options":e.pickOptionsStart},model:{value:e.ruleForm.minDetectionTime,callback:function(t){e.$set(e.ruleForm,"minDetectionTime",t)},expression:"ruleForm.minDetectionTime"}}),e._v(" "),o("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"结束时间",size:"small","picker-options":e.pickOptionsEnd},model:{value:e.ruleForm.maxDetectionTime,callback:function(t){e.$set(e.ruleForm,"maxDetectionTime",t)},expression:"ruleForm.maxDetectionTime"}})],1)],1),e._v(" "),o("div",{staticClass:"operateBox"},[o("el-tooltip",{attrs:{effect:"dark",content:"查询",placement:"top-start"}},[o("el-button",{staticClass:"searchButton",attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:function(t){return e.search(e.ruleForm)}}})],1),e._v(" "),o("el-tooltip",{attrs:{effect:"dark",content:"刷新",placement:"top-start"}},[o("el-button",{staticClass:"refreshButton",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-refresh-right",size:"small"},on:{click:function(t){return e.refresh()}}})],1),e._v(" "),o("el-button",{staticClass:"addTaskButton",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.addTask()}}},[e._v("新增任务")]),e._v(" "),o("el-drawer",{attrs:{title:"新增任务",visible:e.addTaskDrawer,"with-header":!1,wrapperClosable:!1,"close-on-press-esape":!1,"destroy-on-close":!0,size:"40%"},on:{"update:visible":function(t){e.addTaskDrawer=t}}},[o("div",{staticClass:"el-drawer-header"},[o("h3",[e._v("新增任务")])]),e._v(" "),o("div",{staticClass:"el-drawer-content"},[o("el-upload",{directives:[{name:"show",rawName:"v-show",value:e.uploadShow,expression:"uploadShow"}],ref:"uploadTask",staticClass:"uploadTask",attrs:{drag:"",action:"/","http-request":e.uploadTaskFile,"file-list":e.fileList,multiple:"",limit:20,"on-exceed":e.handleExceed,"on-progress":e.handleProgress,accept:".apk",size:"40%"}},[o("i",{staticClass:"el-icon-upload"}),e._v(" "),o("div",{staticClass:"el-upload__text"},[e._v("\n              将文件拖到此处,或"),o("em",[e._v("点击上传")])]),e._v(" "),o("div",{staticClass:"el-upload_tip",attrs:{slot:"tip"},slot:"tip"},[e._v("\n              最多只能上传20个文件\n            ")])]),e._v(" "),e.getLoadingNum>0&&!e.uploadShow?o("div",{staticClass:"fileUploading",staticStyle:{"margin-top":"20px","text-align":"center"}},[o("p",{staticClass:"el-loading-text",staticStyle:{"font-size":"14px",color:"red","margin-top":"5px"}},[e._v("\n              请稍等还有"+e._s(e.getLoadingNum)+"个文件加载中...\n            ")])]):e._e(),e._v(" "),e._l(e.uploadTaskFileItem,function(t,a){return o("div",{key:a},[o("el-form",{ref:"uploadForm",refInFor:!0,staticClass:"uploadForm",attrs:{model:e.uploadForm[a],rules:e.rules}},[o("el-collapse",{staticClass:"applicationInfoCollapse",model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[o("el-collapse-item",{attrs:{title:"应用信息",name:a+1}},[o("el-row",[o("el-col",{attrs:{span:6}},[o("img",{attrs:{src:"data:image/jpg;base64,"+t.appIcon}})]),e._v(" "),o("el-col",{attrs:{span:18}},[o("p",{staticClass:"appName"},[e._v(e._s(t.appName))]),e._v(" "),o("p",{staticClass:"appPackage"},[e._v("\n                        包名:  "+e._s(t.appPackage)+"\n                      ")]),e._v(" "),o("p",[o("span",{staticStyle:{"margin-right":"10px"}},[e._v("版本:  "+e._s(t.appVersion)+"\n                        ")]),e._v(" "),o("span",[e._v("大小:  "+e._s(t.appMbyte)+"MB")])])]),e._v(" "),o("el-col",{staticClass:"detectorStrategyName"},[o("el-form-item",{attrs:{prop:"detectorStrategyId","label-width":"35%"}},[o("label",{attrs:{slot:"label"},slot:"label"},[e._v("检测策略:")]),e._v(" "),o("el-select",{attrs:{placeholder:"请选择检测策略",size:"small","popper-append-to-body":!1},model:{value:e.uploadForm[a].detectorStrategyId,callback:function(t){e.$set(e.uploadForm[a],"detectorStrategyId",t)},expression:"uploadForm[index].detectorStrategyId"}},e._l(e.detectorStrategyList,function(e){return o("el-option",{key:e.strategyId,attrs:{label:e.strategyName,value:e.strategyId}})}),1)],1)],1)],1)],1)],1)],1)],1)})],2),e._v(" "),o("div",{staticClass:"el-drawer-footer"},[o("div",{staticClass:"buttonBox",staticStyle:{display:"inline-block"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveTask()}}},[e._v("保存")]),e._v(" "),o("el-button",{attrs:{plain:""},on:{click:function(t){return e.cancelTask()}}},[e._v("取消")])],1)])])],1)]),e._v(" "),o("div",{staticClass:"androidBody"},[[o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"listItem",attrs:{data:e.listItem,"element-loading-text":"加载中"}},[o("el-table-column",{attrs:{type:"index",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s((e.curpage-1)*e.limit+t.$index+1))])]}}])}),e._v(" "),o("el-table-column",{attrs:{width:"200",prop:"appName",label:"应用名称","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[o("img",{staticClass:"appIcon",attrs:{src:"data:image/jpg;base64,"+t.row.appIcon}}),e._v(" "),o("el-tooltip",{attrs:{effect:"dark",content:t.row.appName,placement:"top-start"}},[o("span",{staticStyle:{"margin-left":"7px"}},[e._v(e._s(t.row.appName))])])]}}])}),e._v(" "),o("el-table-column",{attrs:{width:"240",prop:"appFileName",label:"文件名称","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.appFileName))]}}])}),e._v(" "),o("el-table-column",{attrs:{width:"150",prop:"appVersion",label:"版本"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"version"},[o("img",{staticStyle:{width:"28px"},attrs:{src:a("lhpw")}}),e._v(" "),o("span",[e._v(e._s(t.row.appVersion))])])]}}])}),e._v(" "),o("el-table-column",{attrs:{widt:"150",prop:"detectionFormwork",label:"检测策略"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.detectionFormwork))]}}])}),e._v(" "),o("el-table-column",{attrs:{width:"100",prop:"detectionNumber",label:"检测分数"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.detectionNumber?o("span",[e._v(e._s(t.row.detectionNumber))]):o("span",[e._v("N/A")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"detectionTime",label:"检测时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.detectionTime))]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"detectionStatus",label:"检测状态",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.detectionStatus?o("span",[o("img",{staticClass:"detectionStatusimg",attrs:{src:a("18Qj")}}),e._v("\n              等待检测\n            ")]):1==t.row.detectionStatus?o("span",[o("img",{staticClass:"detectionStatusimg",attrs:{src:a("xH8i")}}),e._v("\n              检测中\n            ")]):2==t.row.detectionStatus?o("span",[o("img",{staticClass:"detectionStatusimg",attrs:{src:a("Agr7")}}),e._v("\n              已完成\n            ")]):3==t.row.detectionStatus?o("span",[o("img",{staticClass:"detectionStatusimg",attrs:{src:a("3xxH")}}),e._v("\n              检测失败\n            ")]):4==t.row.detectionStatus?o("span",[o("img",{staticClass:"detectionStatusimg",attrs:{src:a("Agr7")}}),e._v("\n              引擎检测完成\n            ")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"userName",label:"上传人",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.userName))]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"290",prop:"operate"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-tooltip",{attrs:{effect:"dark",content:"下载报告",placement:"top-start"}},[2==t.row.detectionStatus?[o("i",{staticClass:"el-icon-download  downloadReportIcon",on:{click:function(a){return e.downloadReport(t.row.taskId)}}})]:[o("i",{staticClass:"el-icon-download disabledIcon "})]],2),e._v(" "),o("el-drawer",{ref:"downloadReportDrawer",staticClass:"downloadReportDrawer",attrs:{title:"下载报告",visible:e.downloadReportDrawer,"with-header":!1,wrapperClosable:!1,"close-on-press-escape":!1,"destroy-on-close":!0,size:"40%"},on:{"update:visible":function(t){e.downloadReportDrawer=t}}},[o("div",{staticClass:"el-drawer-header"},[o("h3",[e._v("下载报告")])]),e._v(" "),o("div",{staticClass:"el-drawer-content"},[o("el-form",[o("el-form-item",[o("label",{attrs:{slot:"label"},slot:"label"},[e._v("报告模板:")]),e._v(" "),o("div",[o("el-radio",{attrs:{label:"0"},model:{value:e.reportParameter,callback:function(t){e.reportParameter=t},expression:"reportParameter"}},[e._v("全量报告")]),e._v(" "),o("el-radio",{attrs:{label:"2"},model:{value:e.reportParameter,callback:function(t){e.reportParameter=t},expression:"reportParameter"}},[e._v("整改报告")])],1)]),e._v(" "),o("el-form-item",[o("label",{attrs:{slot:"label"},slot:"label"},[e._v("报告类型:")]),e._v(" "),o("el-radio",{attrs:{label:2},model:{value:e.reportType,callback:function(t){e.reportType=t},expression:"reportType"}},[e._v("PDF ")]),e._v(" "),o("el-radio",{attrs:{label:1},model:{value:e.reportType,callback:function(t){e.reportType=t},expression:"reportType"}},[e._v("WORD")])],1)],1)],1),e._v(" "),o("div",{staticClass:"el-drawer-footer"},[o("div",{staticClass:"buttonBox",staticStyle:{display:"inline-block"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.saveDownloadReport(e.reportParameter)}}},[e._v("保存")]),e._v(" "),o("el-button",{attrs:{plain:""},on:{click:function(t){return e.cancelDownloadReport()}}},[e._v("取消")])],1)])]),e._v(" "),o("el-tooltip",{attrs:{effect:"dark",content:"详情",placement:"top-start"}},[2==t.row.detectionStatus?[o("i",{staticClass:"el-icon-tickets detailIcon",on:{click:function(a){return e.detailTask(t.row.taskId)}}})]:[o("i",{staticClass:"el-icon-tickets disabledIcon"})]],2),e._v(" "),o("el-tooltip",{attrs:{effect:"dark",content:"下载应用",placement:"top-start"}},[o("i",{staticClass:"el-icon-sold-out  dowmloadApplicationIcon",on:{click:function(a){return e.downloadApk(t.row.taskId)}}})]),e._v(" "),o("el-tooltip",{attrs:{effect:"dark",content:"删除",placement:"top-start"}},[o("i",{staticClass:"el-icon-delete deleteIcon",on:{click:function(a){return e.deleteTask(t.row.taskId)}}})])]}}])})],1)]],2),e._v(" "),o("div",{staticClass:"androidBase"},[o("pagination",{on:{pageChanged:e.onPageChanged}})],1)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"androidHeader"},[t("p",[this._v("当前位置:Android检测管理")])])}]};var h=a("VU/8")(v,f,!1,function(e){a("HjWV")},null,null);t.default=h.exports},HjWV:function(e,t){}});
//# sourceMappingURL=11.da6a273115e7403a4f64.js.map